var ke=Object.defineProperty;var te=Object.getOwnPropertySymbols;var Pe=Object.prototype.hasOwnProperty,Oe=Object.prototype.propertyIsEnumerable;var re=(e,t,r)=>t in e?ke(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,g=(e,t)=>{for(var r in t||(t={}))Pe.call(t,r)&&re(e,r,t[r]);if(te)for(var r of te(t))Oe.call(t,r)&&re(e,r,t[r]);return e};import{V as d}from"./vendor.b1428349.js";import{J as Re,b as Ae,a as De,f as Fe,E as je}from"./devterm.eed8f68c.js";import{b as ne}from"./buffer.89012e65.js";const Le=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function r(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerpolicy&&(i.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?i.credentials="include":o.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(o){if(o.ep)return;o.ep=!0;const i=r(o);fetch(o.href,i)}};Le();const Me="modulepreload",oe={},Ve="/",S=function(t,r){return!r||r.length===0?t():Promise.all(r.map(n=>{if(n=`${Ve}${n}`,n in oe)return;oe[n]=!0;const o=n.endsWith(".css"),i=o?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${n}"]${i}`))return;const s=document.createElement("link");if(s.rel=o?"stylesheet":Me,o||(s.as="script",s.crossOrigin=""),s.href=n,document.head.appendChild(s),o)return new Promise((a,c)=>{s.addEventListener("load",a),s.addEventListener("error",c)})})).then(()=>t())};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var W=function(e,t){return W=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,n){r.__proto__=n}||function(r,n){for(var o in n)n.hasOwnProperty(o)&&(r[o]=n[o])},W(e,t)};function w(e,t){W(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}function F(e){return typeof e=="function"}var ie=!1,_={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){if(e){var t=new Error;""+t.stack}ie=e},get useDeprecatedSynchronousErrorHandling(){return ie}};function R(e){setTimeout(function(){throw e},0)}var j={closed:!0,next:function(e){},error:function(e){if(_.useDeprecatedSynchronousErrorHandling)throw e;R(e)},complete:function(){}},se=function(){return Array.isArray||function(e){return e&&typeof e.length=="number"}}();function Ne(e){return e!==null&&typeof e=="object"}var He=function(){function e(t){return Error.call(this),this.message=t?t.length+` errors occurred during unsubscription:
`+t.map(function(r,n){return n+1+") "+r.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=t,this}return e.prototype=Object.create(Error.prototype),e}(),L=He,I=function(){function e(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._ctorUnsubscribe=!0,this._unsubscribe=t)}return e.prototype.unsubscribe=function(){var t;if(!this.closed){var r=this,n=r._parentOrParents,o=r._ctorUnsubscribe,i=r._unsubscribe,s=r._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,n instanceof e)n.remove(this);else if(n!==null)for(var a=0;a<n.length;++a){var c=n[a];c.remove(this)}if(F(i)){o&&(this._unsubscribe=void 0);try{i.call(this)}catch(m){t=m instanceof L?ce(m.errors):[m]}}if(se(s))for(var a=-1,l=s.length;++a<l;){var b=s[a];if(Ne(b))try{b.unsubscribe()}catch(u){t=t||[],u instanceof L?t=t.concat(ce(u.errors)):t.push(u)}}if(t)throw new L(t)}},e.prototype.add=function(t){var r=t;if(!t)return e.EMPTY;switch(typeof t){case"function":r=new e(t);case"object":if(r===this||r.closed||typeof r.unsubscribe!="function")return r;if(this.closed)return r.unsubscribe(),r;if(!(r instanceof e)){var n=r;r=new e,r._subscriptions=[n]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}var o=r._parentOrParents;if(o===null)r._parentOrParents=this;else if(o instanceof e){if(o===this)return r;r._parentOrParents=[o,this]}else if(o.indexOf(this)===-1)o.push(this);else return r;var i=this._subscriptions;return i===null?this._subscriptions=[r]:i.push(r),r},e.prototype.remove=function(t){var r=this._subscriptions;if(r){var n=r.indexOf(t);n!==-1&&r.splice(n,1)}},e.EMPTY=function(t){return t.closed=!0,t}(new e),e}();function ce(e){return e.reduce(function(t,r){return t.concat(r instanceof L?r.errors:r)},[])}var M=function(){return typeof Symbol=="function"?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}(),x=function(e){w(t,e);function t(r,n,o){var i=e.call(this)||this;switch(i.syncErrorValue=null,i.syncErrorThrown=!1,i.syncErrorThrowable=!1,i.isStopped=!1,arguments.length){case 0:i.destination=j;break;case 1:if(!r){i.destination=j;break}if(typeof r=="object"){r instanceof t?(i.syncErrorThrowable=r.syncErrorThrowable,i.destination=r,r.add(i)):(i.syncErrorThrowable=!0,i.destination=new ae(i,r));break}default:i.syncErrorThrowable=!0,i.destination=new ae(i,r,n,o);break}return i}return t.prototype[M]=function(){return this},t.create=function(r,n,o){var i=new t(r,n,o);return i.syncErrorThrowable=!1,i},t.prototype.next=function(r){this.isStopped||this._next(r)},t.prototype.error=function(r){this.isStopped||(this.isStopped=!0,this._error(r))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(r){this.destination.next(r)},t.prototype._error=function(r){this.destination.error(r),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var r=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=r,this},t}(I),ae=function(e){w(t,e);function t(r,n,o,i){var s=e.call(this)||this;s._parentSubscriber=r;var a,c=s;return F(n)?a=n:n&&(a=n.next,o=n.error,i=n.complete,n!==j&&(c=Object.create(n),F(c.unsubscribe)&&s.add(c.unsubscribe.bind(c)),c.unsubscribe=s.unsubscribe.bind(s))),s._context=c,s._next=a,s._error=o,s._complete=i,s}return t.prototype.next=function(r){if(!this.isStopped&&this._next){var n=this._parentSubscriber;!_.useDeprecatedSynchronousErrorHandling||!n.syncErrorThrowable?this.__tryOrUnsub(this._next,r):this.__tryOrSetError(n,this._next,r)&&this.unsubscribe()}},t.prototype.error=function(r){if(!this.isStopped){var n=this._parentSubscriber,o=_.useDeprecatedSynchronousErrorHandling;if(this._error)!o||!n.syncErrorThrowable?(this.__tryOrUnsub(this._error,r),this.unsubscribe()):(this.__tryOrSetError(n,this._error,r),this.unsubscribe());else if(n.syncErrorThrowable)o?(n.syncErrorValue=r,n.syncErrorThrown=!0):R(r),this.unsubscribe();else{if(this.unsubscribe(),o)throw r;R(r)}}},t.prototype.complete=function(){var r=this;if(!this.isStopped){var n=this._parentSubscriber;if(this._complete){var o=function(){return r._complete.call(r._context)};!_.useDeprecatedSynchronousErrorHandling||!n.syncErrorThrowable?(this.__tryOrUnsub(o),this.unsubscribe()):(this.__tryOrSetError(n,o),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(r,n){try{r.call(this._context,n)}catch(o){if(this.unsubscribe(),_.useDeprecatedSynchronousErrorHandling)throw o;R(o)}},t.prototype.__tryOrSetError=function(r,n,o){if(!_.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{n.call(this._context,o)}catch(i){return _.useDeprecatedSynchronousErrorHandling?(r.syncErrorValue=i,r.syncErrorThrown=!0,!0):(R(i),!0)}return!1},t.prototype._unsubscribe=function(){var r=this._parentSubscriber;this._context=null,this._parentSubscriber=null,r.unsubscribe()},t}(x);function Ue(e){for(;e;){var t=e,r=t.closed,n=t.destination,o=t.isStopped;if(r||o)return!1;n&&n instanceof x?e=n:e=null}return!0}function ze(e,t,r){if(e){if(e instanceof x)return e;if(e[M])return e[M]()}return!e&&!t&&!r?new x(j):new x(e,t,r)}var Be=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function Ze(e){return e}function Ge(e){return e.length===0?Ze:e.length===1?e[0]:function(r){return e.reduce(function(n,o){return o(n)},r)}}var V=function(){function e(t){this._isScalar=!1,t&&(this._subscribe=t)}return e.prototype.lift=function(t){var r=new e;return r.source=this,r.operator=t,r},e.prototype.subscribe=function(t,r,n){var o=this.operator,i=ze(t,r,n);if(o?i.add(o.call(i,this.source)):i.add(this.source||_.useDeprecatedSynchronousErrorHandling&&!i.syncErrorThrowable?this._subscribe(i):this._trySubscribe(i)),_.useDeprecatedSynchronousErrorHandling&&i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i},e.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(r){_.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=r),Ue(t)?t.error(r):console.warn(r)}},e.prototype.forEach=function(t,r){var n=this;return r=ue(r),new r(function(o,i){var s;s=n.subscribe(function(a){try{t(a)}catch(c){i(c),s&&s.unsubscribe()}},i,o)})},e.prototype._subscribe=function(t){var r=this.source;return r&&r.subscribe(t)},e.prototype[Be]=function(){return this},e.prototype.pipe=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return t.length===0?this:Ge(t)(this)},e.prototype.toPromise=function(t){var r=this;return t=ue(t),new t(function(n,o){var i;r.subscribe(function(s){return i=s},function(s){return o(s)},function(){return n(i)})})},e.create=function(t){return new e(t)},e}();function ue(e){if(e||(e=_.Promise||Promise),!e)throw new Error("no Promise impl found");return e}var We=function(){function e(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return e.prototype=Object.create(Error.prototype),e}(),A=We,Xe=function(e){w(t,e);function t(r,n){var o=e.call(this)||this;return o.subject=r,o.subscriber=n,o.closed=!1,o}return t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var r=this.subject,n=r.observers;if(this.subject=null,!(!n||n.length===0||r.isStopped||r.closed)){var o=n.indexOf(this.subscriber);o!==-1&&n.splice(o,1)}}},t}(I),le=function(e){w(t,e);function t(r){var n=e.call(this,r)||this;return n.destination=r,n}return t}(x),fe=function(e){w(t,e);function t(){var r=e.call(this)||this;return r.observers=[],r.closed=!1,r.isStopped=!1,r.hasError=!1,r.thrownError=null,r}return t.prototype[M]=function(){return new le(this)},t.prototype.lift=function(r){var n=new pe(this,this);return n.operator=r,n},t.prototype.next=function(r){if(this.closed)throw new A;if(!this.isStopped)for(var n=this.observers,o=n.length,i=n.slice(),s=0;s<o;s++)i[s].next(r)},t.prototype.error=function(r){if(this.closed)throw new A;this.hasError=!0,this.thrownError=r,this.isStopped=!0;for(var n=this.observers,o=n.length,i=n.slice(),s=0;s<o;s++)i[s].error(r);this.observers.length=0},t.prototype.complete=function(){if(this.closed)throw new A;this.isStopped=!0;for(var r=this.observers,n=r.length,o=r.slice(),i=0;i<n;i++)o[i].complete();this.observers.length=0},t.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},t.prototype._trySubscribe=function(r){if(this.closed)throw new A;return e.prototype._trySubscribe.call(this,r)},t.prototype._subscribe=function(r){if(this.closed)throw new A;return this.hasError?(r.error(this.thrownError),I.EMPTY):this.isStopped?(r.complete(),I.EMPTY):(this.observers.push(r),new Xe(this,r))},t.prototype.asObservable=function(){var r=new V;return r.source=this,r},t.create=function(r,n){return new pe(r,n)},t}(V),pe=function(e){w(t,e);function t(r,n){var o=e.call(this)||this;return o.destination=r,o.source=n,o}return t.prototype.next=function(r){var n=this.destination;n&&n.next&&n.next(r)},t.prototype.error=function(r){var n=this.destination;n&&n.error&&this.destination.error(r)},t.prototype.complete=function(){var r=this.destination;r&&r.complete&&this.destination.complete()},t.prototype._subscribe=function(r){var n=this.source;return n?this.source.subscribe(r):I.EMPTY},t}(fe);function he(){return function(t){return t.lift(new qe(t))}}var qe=function(){function e(t){this.connectable=t}return e.prototype.call=function(t,r){var n=this.connectable;n._refCount++;var o=new Je(t,n),i=r.subscribe(o);return o.closed||(o.connection=n.connect()),i},e}(),Je=function(e){w(t,e);function t(r,n){var o=e.call(this,r)||this;return o.connectable=n,o}return t.prototype._unsubscribe=function(){var r=this.connectable;if(!r){this.connection=null;return}this.connectable=null;var n=r._refCount;if(n<=0){this.connection=null;return}if(r._refCount=n-1,n>1){this.connection=null;return}var o=this.connection,i=r._connection;this.connection=null,i&&(!o||i===o)&&i.unsubscribe()},t}(x),Ye=function(e){w(t,e);function t(r,n){var o=e.call(this)||this;return o.source=r,o.subjectFactory=n,o._refCount=0,o._isComplete=!1,o}return t.prototype._subscribe=function(r){return this.getSubject().subscribe(r)},t.prototype.getSubject=function(){var r=this._subject;return(!r||r.isStopped)&&(this._subject=this.subjectFactory()),this._subject},t.prototype.connect=function(){var r=this._connection;return r||(this._isComplete=!1,r=this._connection=new I,r.add(this.source.subscribe(new Ke(this.getSubject(),this))),r.closed&&(this._connection=null,r=I.EMPTY)),r},t.prototype.refCount=function(){return he()(this)},t}(V),Qe=function(){var e=Ye.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:e._subscribe},_isComplete:{value:e._isComplete,writable:!0},getSubject:{value:e.getSubject},connect:{value:e.connect},refCount:{value:e.refCount}}}(),Ke=function(e){w(t,e);function t(r,n){var o=e.call(this,r)||this;return o.connectable=n,o}return t.prototype._error=function(r){this._unsubscribe(),e.prototype._error.call(this,r)},t.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){var r=this.connectable;if(r){this.connectable=null;var n=r._connection;r._refCount=0,r._subject=null,r._connection=null,n&&n.unsubscribe()}},t}(le);function et(e,t){return function(n){if(typeof e!="function")throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new tt(e,t))}}var tt=function(){function e(t,r){this.project=t,this.thisArg=r}return e.prototype.call=function(t,r){return r.subscribe(new rt(t,this.project,this.thisArg))},e}(),rt=function(e){w(t,e);function t(r,n,o){var i=e.call(this,r)||this;return i.project=n,i.count=0,i.thisArg=o||i,i}return t.prototype._next=function(r){var n;try{n=this.project.call(this.thisArg,r,this.count++)}catch(o){this.destination.error(o);return}this.destination.next(n)},t}(x);function N(e,t,r,n){return F(r)&&(n=r,r=void 0),n?N(e,t,r).pipe(et(function(o){return se(o)?n.apply(void 0,o):n(o)})):new V(function(o){function i(s){arguments.length>1?o.next(Array.prototype.slice.call(arguments)):o.next(s)}de(e,t,i,o,r)})}function de(e,t,r,n,o){var i;if(it(e)){var s=e;e.addEventListener(t,r,o),i=function(){return s.removeEventListener(t,r,o)}}else if(ot(e)){var a=e;e.on(t,r),i=function(){return a.off(t,r)}}else if(nt(e)){var c=e;e.addListener(t,r),i=function(){return c.removeListener(t,r)}}else if(e&&e.length)for(var l=0,b=e.length;l<b;l++)de(e[l],t,r,n,o);else throw new TypeError("Invalid event target");n.add(i)}function nt(e){return e&&typeof e.addListener=="function"&&typeof e.removeListener=="function"}function ot(e){return e&&typeof e.on=="function"&&typeof e.off=="function"}function it(e){return e&&typeof e.addEventListener=="function"&&typeof e.removeEventListener=="function"}function st(e,t){return function(n){var o;if(typeof e=="function"?o=e:o=function(){return e},typeof t=="function")return n.lift(new ct(o,t));var i=Object.create(n,Qe);return i.source=n,i.subjectFactory=o,i}}var ct=function(){function e(t,r){this.subjectFactory=t,this.selector=r}return e.prototype.call=function(t,r){var n=this.selector,o=this.subjectFactory(),i=n(o).subscribe(t);return i.add(r.subscribe(o)),i},e}();function at(){return new fe}function X(){return function(e){return he()(st(at)(e))}}N(window,"resize").pipe(X());N(window,"keypress").pipe(X());const tn=N(window,"keyup").pipe(X()),ut=e=>new Promise(t=>{const r=document.createElement("input");r.type="file",r.accept=(e||[]).join(","),r.click(),r.addEventListener("change",n=>{const o=(n.dataTransfer||n.target).files;r.remove(),t(o)})}),lt=e=>{h()&&(e.on("connect",()=>{window.electron.ipcRenderer.invoke("client","connect",!0)}),e.on("disconnect",()=>{window.electron.ipcRenderer.invoke("client","connect",!1)}))},ft=()=>{window.electron.ipcRenderer.invoke("window","minimize")},pt=()=>{window.electron.ipcRenderer.invoke("window","maximize")},ht=e=>{if(h())window.electron.ipcRenderer.invoke("window","fullscreen",e);else return e?document.body.requestFullscreen():document.exitFullscreen()},dt=()=>{window.electron.ipcRenderer.invoke("close")},h=()=>"electron"in window,_t=e=>{if(h())return window.electron.ipcRenderer.invoke("save",e);{const t="data:text/json;charset=utf-8,"+encodeURIComponent(JSON.stringify(e)),r=document.createElement("a");r.setAttribute("href",t),r.setAttribute("download","scene.json"),r.click()}},vt=async()=>{if(h())return window.electron.ipcRenderer.invoke("load");{const e=await ut("text");return new Promise((t,r)=>{if(e.length){const n=new FileReader;n.addEventListener("load",()=>{try{t(JSON.parse(n.result))}catch(o){r(o)}}),n.readAsText(e[0])}else t()})}},bt=e=>{h()&&window.electron.ipcRendererReceive("dialog",e)},mt=e=>{h()?window.electron.ipcRendererReceive("window",(t,r)=>{switch(t){case"fullscreen":e(r);break}}):window.addEventListener("fullscreenchange",()=>{e(document.fullscreenEnabled)})},yt=()=>h()?window.electron.ipcRenderer.invoke("loadConfig"):JSON.parse(window.localStorage.getItem("config")),gt=e=>h()?window.electron.ipcRenderer.invoke("saveConfig",e):window.localStorage.setItem("config",JSON.stringify(e)),wt=()=>h()?window.electron.ipcRenderer.invoke("getCurrentVersion"):"1.0.0-beta.15",St=()=>{if(h())return window.electron.ipcRenderer.invoke("getFonts");{const t=(()=>{const r=[],n=[!1,!0],o=[100,200,300,400,500,600,700,800,900];for(let i=0;i<n.length;i++)for(let s=0;s<o.length;s++)r.push({weight:o[s],italic:n[i]});return r})();return[{family:"Arial",monospace:!1,variants:t},{family:"Verdana ",monospace:!1,variants:t},{family:"Helvetica ",monospace:!1,variants:t},{family:"Tahoma ",monospace:!1,variants:t},{family:"Trebuchet MS ",monospace:!1,variants:t},{family:"Times New Roman ",monospace:!1,variants:t},{family:"Georgia ",monospace:!1,variants:t},{family:"Garamond ",monospace:!1,variants:t},{family:"Courier New ",monospace:!0,variants:t},{family:"Brush Script MT ",monospace:!1,variants:t},{family:"sans-serif",monospace:!1,variants:t},{family:"monospace ",monospace:!0,variants:t}]}};var Et=6,rn=16,xt=9224,$t=384,f={SIZE_8_16_THIN_1:0,SIZE_8_16_THIN_2:4,SIZE_5_7:1,SIZE_6_12:2,SIZE_7_14:3},nn={[f.SIZE_5_7]:76,[f.SIZE_6_12]:63,[f.SIZE_7_14]:54,[f.SIZE_8_16_THIN_1]:47,[f.SIZE_8_16_THIN_2]:47},on={[f.SIZE_8_16_THIN_1]:[8,16],[f.SIZE_8_16_THIN_2]:[8,16],[f.SIZE_7_14]:[7,14],[f.SIZE_6_12]:[6,12],[f.SIZE_5_7]:[5,7]},$={LEFT:0,CENTER:1,RIGHT:2},sn=()=>({align:$.LEFT,font:f.SIZE_8_16_THIN_1,margin:0,underline:0,lineSpace:0,density:Et,underLine:0,wordGap:0}),Ct="/assets/5x7-ISO8859-1.1e468e9f.ttf",It="/assets/6x12-ISO8859-1.4c4c24d1.ttf",Tt="/assets/7x14-ISO8859-1.b8471bdd.ttf",kt="/assets/Px437_CompaqThin_8x16.ccffc04f.ttf";const Pt=()=>{const e=[["5x7-ISO8859-1",`url(${Ct})`],["6x12-ISO8859-1",`url(${It})`],["7x14-ISO8859-1",`url(${Tt})`],["Px437_CompaqThin_8x16",`url(${kt})`]];return Promise.all(e.map(async t=>{console.log("load font",t[0],t[1]);const r=new FontFace(...t);return await r.load(),document.fonts.add(r),r}))},cn={[f.SIZE_5_7]:{fontFamily:"5x7-ISO8859-1",fontSize:7},[f.SIZE_6_12]:{fontFamily:"6x12-ISO8859-1",fontSize:12},[f.SIZE_7_14]:{fontFamily:"7x14-ISO8859-1",fontSize:14},[f.SIZE_8_16_THIN_1]:{fontFamily:"Px437_CompaqThin_8x16",fontSize:16},[f.SIZE_8_16_THIN_2]:{fontFamily:"Px437_CompaqThin_8x16",fontSize:16}};var H,Ot=new Uint8Array(16);function Rt(){if(!H&&(H=typeof crypto!="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto!="undefined"&&typeof msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto),!H))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return H(Ot)}var At=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Dt(e){return typeof e=="string"&&At.test(e)}var p=[];for(var q=0;q<256;++q)p.push((q+256).toString(16).substr(1));function Ft(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,r=(p[e[t+0]]+p[e[t+1]]+p[e[t+2]]+p[e[t+3]]+"-"+p[e[t+4]]+p[e[t+5]]+"-"+p[e[t+6]]+p[e[t+7]]+"-"+p[e[t+8]]+p[e[t+9]]+"-"+p[e[t+10]]+p[e[t+11]]+p[e[t+12]]+p[e[t+13]]+p[e[t+14]]+p[e[t+15]]).toLowerCase();if(!Dt(r))throw TypeError("Stringified UUID is invalid");return r}function jt(e,t,r){e=e||{};var n=e.random||(e.rng||Rt)();if(n[6]=n[6]&15|64,n[8]=n[8]&63|128,t){r=r||0;for(var o=0;o<16;++o)t[r+o]=n[o];return t}return Ft(n)}class Lt{constructor(t){const{type:r,value:n}=t||{};this.id=jt(),this.type=r,this.value=n}toJSON(){return{id:this.id,type:this.type,value:this.value}}}var Mt=[{type:"reset"},{type:"setFont",value:f.SIZE_8_16_THIN_1},{type:"text",value:{text:"Sample",options:{fontSize:16,align:"left",lineSpace:0,wordGap:0,margin:0,fontFamily:"Arial",color:0}}},{type:"feedPitch",value:{value:15,type:"font"}}],Vt=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"app-menu"},[r("ul",[e._t("default")],2)])},Nt=[];function T(e,t,r,n,o,i,s,a){var c=typeof e=="function"?e.options:e;t&&(c.render=t,c.staticRenderFns=r,c._compiled=!0),n&&(c.functional=!0),i&&(c._scopeId="data-v-"+i);var l;if(s?(l=function(u){u=u||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!u&&typeof __VUE_SSR_CONTEXT__!="undefined"&&(u=__VUE_SSR_CONTEXT__),o&&o.call(this,u),u&&u._registeredComponents&&u._registeredComponents.add(s)},c._ssrRegister=l):o&&(l=a?function(){o.call(this,(c.functional?this.parent:this).$root.$options.shadowRoot)}:o),l)if(c.functional){c._injectStyles=l;var b=c.render;c.render=function(P,E){return l.call(E),b(P,E)}}else{var m=c.beforeCreate;c.beforeCreate=m?[].concat(m,l):[l]}return{exports:e,options:c}}const Ht={},_e={};var Ut=T(Ht,Vt,Nt,!1,zt,"447d30c4",null,null);function zt(e){for(let t in _e)this[t]=_e[t]}var Bt=function(){return Ut.exports}(),Zt=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("button",e._g({staticClass:"base-generic-button"},e.$listeners),[e._t("default",function(){return[e._v(e._s(e.text))]})],2)},Gt=[];const Wt={props:{text:{type:String,default:"Button Text"}}},ve={};var Xt=T(Wt,Zt,Gt,!1,qt,"eeccf710",null,null);function qt(e){for(let t in ve)this[t]=ve[t]}var Jt=function(){return Xt.exports}(),Yt=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("li",{staticClass:"app-menu-item",class:{selected:e.selected}},[r("base-generic-button",e._g(e._b({},"base-generic-button",e.$attrs,!1),e.$listeners),[e._t("default",function(){return[e._v(e._s(e.text))]})],2)],1)},Qt=[];const Kt={components:{BaseGenericButton:Jt},inheritAttrs:!1,props:{selected:{type:Boolean,default:!1},text:{type:String,default:null}}},be={};var er=T(Kt,Yt,Qt,!1,tr,"3f1b0188",null,null);function tr(e){for(let t in be)this[t]=be[t]}var v=function(){return er.exports}(),rr=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("li",e._g(e._b({staticClass:"app-menu-text"},"li",e.$attrs,!1),e.$listeners),[e._t("default",function(){return[r("span",{domProps:{innerHTML:e._s(e.text)}})]})],2)},nr=[];const or={inheritAttrs:!1,props:{text:{type:String,default:null}}},me={};var ir=T(or,rr,nr,!1,sr,"11d97818",null,null);function sr(e){for(let t in me)this[t]=me[t]}var U=function(){return ir.exports}(),cr=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("li",{staticClass:"app-menu-spacer"},[e._t("default")],2)},ar=[];const ur={},ye={};var lr=T(ur,cr,ar,!1,fr,"d155e842",null,null);function fr(e){for(let t in ye)this[t]=ye[t]}var J=function(){return lr.exports}(),pr=function(){var e=this,t=e.$createElement;return e._self._c,e._m(0)},hr=[function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("li",{staticClass:"app-menu-divider"},[r("i")])}];const dr={},ge={};var _r=T(dr,pr,hr,!1,vr,"12222a62",null,null);function vr(e){for(let t in ge)this[t]=ge[t]}var O=function(){return _r.exports}(),br=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"app",class:{ready:e.ready},style:e.style},[r("app-menu",{staticClass:"header"},e._l(e.headerItems,function(n,o){return r(n.component,e._g(e._b({key:o,tag:"component"},"component",n.props,!1),n.on))}),1),r("div",{staticClass:"app-content"},[!e.$client.connected&&e.ready?r("view-start",{on:{apply:e.onApplyViewStart}}):e.currentView===e.VIEWS.PRINTER?r("view-printer",{attrs:{colors:e.colors},model:{value:e.printerTemplate,callback:function(n){e.printerTemplate=n},expression:"printerTemplate"}}):e.currentView===e.VIEWS.INFO?r("view-info"):e._e()],1),r("app-menu",{staticClass:"footer"},e._l(e.footerItems,function(n,o){return r(n.component,e._g(e._b({key:o,tag:"component"},"component",n.props,!1),n.on))}),1),e._l(e.$errorList.errors,function(n,o){return r("dialog-error",e._b({key:o,attrs:{"init-open":""}},"dialog-error",n,!1))}),e._l(e.$dialog.prompts,function(n,o){return r("dialog-prompt",e._b({key:o,attrs:{"init-open":""}},"dialog-prompt",n,!1))}),e.ready?r("dialog-remote",{ref:"dialogRemote"}):e._e(),e.ready?r("dialog-server",{ref:"dialogServer"}):e._e(),e.ready?r("dialog-options",{ref:"dialogOptions"}):e._e()],2)},mr=[];const k={NONE:null,INFO:"info",START:"start",PRINTER:"priner"},yr={amber:{primary:[255,204,0],secondary:[0,0,0],printer:{preview:{background:[255,204,0],foreground:[0,0,0]}}},green:{primary:[51,255,0],secondary:[0,0,0],printer:{preview:{background:[51,255,0],foreground:[0,0,0]}}},whiteBlack:{primary:[255,255,255],secondary:[0,0,0],printer:{preview:{background:[255,255,255],foreground:[0,0,0]}}},blackWhite:{primary:[0,0,0],secondary:[255,255,255],printer:{preview:{background:[0,0,0],foreground:[255,255,255]}}}};function gr(){return Mt.map(e=>new Lt(e))}const wr={components:{ViewPrinter:()=>S(()=>import("./Printer.765364f3.js").then(function(e){return e.P}),["assets/Printer.765364f3.js","assets/Printer.24768bf9.css","assets/View.c40cc634.js","assets/TextButton.8a136169.js","assets/TextButton.63200045.css","assets/TextField.bcd10360.js","assets/TextField.11f65af1.css","assets/Dialog.ca0be6c5.js","assets/Dialog.1893bfc8.css","assets/FileSelect.0a4fdd11.js","assets/FileSelect.5a9fa111.css","assets/CheckBox.9c65fd89.js","assets/CheckBox.82b15c7e.css"]),ViewStart:()=>S(()=>import("./Start.1cca67d0.js"),["assets/Start.1cca67d0.js","assets/Start.7de09691.css","assets/View.c40cc634.js","assets/TextButton.8a136169.js","assets/TextButton.63200045.css","assets/vendor.b1428349.js","assets/devterm.eed8f68c.js","assets/buffer.89012e65.js"]),ViewInfo:()=>S(()=>import("./Info.38f01e31.js"),["assets/Info.38f01e31.js","assets/Info.323bbd9f.css","assets/View.c40cc634.js","assets/vendor.b1428349.js","assets/devterm.eed8f68c.js","assets/buffer.89012e65.js"]),AppMenu:Bt,AppMenuItem:v,AppMenuText:U,AppMenuSpacer:J,AppMenuDivider:O,DialogError:()=>S(()=>import("./Error.ecc48ea9.js"),["assets/Error.ecc48ea9.js","assets/Error.d6470d93.css","assets/Dialog.ca0be6c5.js","assets/Dialog.1893bfc8.css","assets/TextButton.8a136169.js","assets/TextButton.63200045.css","assets/vendor.b1428349.js","assets/devterm.eed8f68c.js","assets/buffer.89012e65.js"]),DialogRemote:()=>S(()=>import("./Remote.03bbfcd0.js"),["assets/Remote.03bbfcd0.js","assets/Remote.cb7e31b7.css","assets/TextField.bcd10360.js","assets/TextField.11f65af1.css","assets/Dialog.ca0be6c5.js","assets/Dialog.1893bfc8.css","assets/CheckBox.9c65fd89.js","assets/CheckBox.82b15c7e.css","assets/TextButton.8a136169.js","assets/TextButton.63200045.css","assets/vendor.b1428349.js","assets/devterm.eed8f68c.js","assets/buffer.89012e65.js"]),DialogServer:()=>S(()=>import("./Server.30e211a8.js"),["assets/Server.30e211a8.js","assets/Server.60f2006a.css","assets/TextField.bcd10360.js","assets/TextField.11f65af1.css","assets/Dialog.ca0be6c5.js","assets/Dialog.1893bfc8.css","assets/FileSelect.0a4fdd11.js","assets/FileSelect.5a9fa111.css","assets/TextButton.8a136169.js","assets/TextButton.63200045.css","assets/CheckBox.9c65fd89.js","assets/CheckBox.82b15c7e.css","assets/vendor.b1428349.js","assets/devterm.eed8f68c.js","assets/buffer.89012e65.js"]),DialogOptions:()=>S(()=>import("./Options.11ec0450.js"),["assets/Options.11ec0450.js","assets/Options.cdc76cd0.css","assets/TextField.bcd10360.js","assets/TextField.11f65af1.css","assets/Dialog.ca0be6c5.js","assets/Dialog.1893bfc8.css","assets/TextButton.8a136169.js","assets/TextButton.63200045.css","assets/vendor.b1428349.js","assets/devterm.eed8f68c.js","assets/buffer.89012e65.js"]),DialogPrompt:()=>S(()=>import("./Prompt.40c698ae.js"),["assets/Prompt.40c698ae.js","assets/Prompt.dea47229.css","assets/Dialog.ca0be6c5.js","assets/Dialog.1893bfc8.css","assets/TextButton.8a136169.js","assets/TextButton.63200045.css","assets/vendor.b1428349.js","assets/devterm.eed8f68c.js","assets/buffer.89012e65.js"])},data(){return{VIEWS:k,currentView:k.PRINTER,ready:!1,fullscreen:!1,printerTemplate:gr()}},computed:{headerItems(){const e=[{component:v,on:{click:this.onClickNew},props:{text:"New"}},{component:O},{component:v,on:{click:this.onClickSave},props:{text:"Save"}},{component:v,title:"Load",on:{click:this.onClickLoad},props:{text:"Load"}},{component:O}];return[...this.$client.connected&&[{component:v,on:{click:()=>this.currentView=k.INFO},props:{selected:this.currentView===k.INFO,text:"Info"}},{component:v,on:{click:()=>this.currentView=k.PRINTER},props:{selected:this.currentView===k.PRINTER,text:"Printer"}}]||[],{component:J},...this.$client.connected&&this.currentView===k.PRINTER&&e||[],{component:v,on:{click:this.onClickOptions},props:{text:"Options"}},h()&&[{component:O},{component:v,on:{click:this.onClickClose},props:{text:"Close"}}]].flat().filter(Boolean)},footerItems(){return[h()&&[{component:v,on:{click:this.onClickMinimizeWindow},props:{text:"Minimize"}},{component:v,on:{click:this.onClickMaximizeWindow},props:{text:"Maximize"}}].flat(),{component:v,on:{click:this.onClickFullscreen},props:{selected:this.fullscreen,text:"Fullscreen"}},{component:J},this.hasServer&&[{component:U,on:{click:this.showServerDialog},props:{class:{connection:!0,connected:this.$server.options.active},text:`${this.$server.options.active?`Server (*:${this.$server.options.port}${this.$server.options.secure?"/SSL":""})`:"Server Offline"}`}},{component:O}],{component:U,on:{click:this.showRemoteDialog},props:{class:{connection:!0,connected:this.clientConnected},text:`${this.clientConnected?`Online (${this.$client.host}:${this.$client.port}${this.$client.secure?"/SSL":""})`:"Offline"}`}},{component:O},{component:U,props:{class:"info-version",text:this.version}}].flat().filter(Boolean)},hasServer(){return!this.$server.disabled},version(){return this.$config.version},colors(){return yr[this.$config.data.theme]},clientConnected(){return this.$client.connected},style(){return g({"--color-primary":`rgb(${this.colors.primary.join(",")})`,"--color-secondary":`rgb(${this.colors.secondary.join(",")})`},Object.fromEntries(Array(10).fill("").map((e,t)=>[`--color-primary-${(t+1)*10}`,`rgb(${this.colors.primary.join(" ")} / ${(t+1)*10}%)`])))}},async mounted(){await Pt(),await this.$config.init(),await this.$server.init(),this.hasServer&&await this.$server.refresh(),await this.$config.load();const e=this.$config.get("profiles").find(({name:t})=>t===this.$config.get("profile"));if(e){const{port:t,host:r,ssl:n,secure:o}=e;if(this.$config.get("startType")&&t)try{this.$server&&this.$config.get("startType")==="local"&&!this.$server.options.active&&await this.$server.start(t,n),r&&await this.$client.connect(t,r,o)}catch{}}this.ready=!0,this.registerListeners()},methods:{registerListeners(){mt(e=>{this.fullscreen=e}),bt((e,t)=>{switch(e){case"open":switch(t){case"options":this.showOptionsDialog();break;case"remote":this.showRemoteDialog();break;case"server":this.showServerDialog();break}break}})},onClickMinimizeWindow(){return ft()},onClickMaximizeWindow(){return pt()},onClickFullscreen(){return ht(!this.fullscreen)},onClickClose(){return dt()},onClickNew(){this.printerTemplate=[]},onClickSave(){return _t(this.printerTemplate)},async onClickLoad(){try{const e=await vt();e&&(this.printerTemplate=e)}catch(e){this.$errorList.add(e)}},onClickOptions(){this.showOptionsDialog()},async onApplyViewStart({type:e}){this.$config.set("startType",e);let t={};switch(e){case"local":t=await this.showServerDialog();break;case"remote":t=await this.showRemoteDialog();break}const{profile:r}=t||{};r&&(this.$config.set("profile",r),await this.$config.save())},showServerDialog(){return this.$refs.dialogServer.show()},showRemoteDialog(){return this.$refs.dialogRemote.show()},showOptionsDialog(){return this.$refs.dialogOptions.show()}}},we={};var Sr=T(wr,br,mr,!1,Er,"0b8d7e95",null,null);function Er(e){for(let t in we)this[t]=we[t]}var Se=function(){return Sr.exports}();class xr{constructor(){this.errors=[]}add(t,r){typeof t=="object"&&(console.error(t),t.type&&(r=t.type),t=t.message);const n={title:r,message:t},o=()=>{this.errors.slice(this.errors.indexOf(n),1)};n.callback=o,this.errors.push(n)}}const Ee=d.observable(new xr);Object.defineProperty(d.prototype,"$errorList",{get(){return Ee}});const an=512,z=()=>({theme:"amber",startType:null,ssl:{key:null,cert:null,pfx:null,passphrase:null},profiles:[]}),$r=()=>({name:null,port:3e3,host:null,secure:!1,ssl:{key:null,cert:null,pfx:null,passphrase:null}}),un="localhost",Cr="Profile Default";class Ir{constructor(){this.data=z(),this.version=null,this.fonts=[]}async init(){this.version=await wt(),this.fonts=await St()}toJSON(){return Object.assign({},this.data,{version:this.version})}get(t){return this.data[t]}set(t,r){typeof t=="string"?this.data[t]=r:typeof t=="object"&&Object.entries(t).forEach(([n,o])=>this.set(n,o))}save(){return gt(this.toJSON())}reset(){return this.data=z(),this.save()}async load(){let t;try{t=await yt()}catch{t=z()}return console.log(t),this.data=Object.assign(z(),t)}saveProfile(t){t.name=t.name||Cr;const r=this.get("profiles");let n=this.get("profiles").find(({name:o})=>o===t.name);return n?(console.log("update profile",n.name,n),r[r.indexOf(n)]=g(g({},n),t)):(console.log("create profile",t.name,t),n=g(g({},$r()),t),r.push(n)),this.set("profiles",r),this.save()}deleteProfile(t){const r=this.get("profiles"),n=this.get("profiles").find(({name:o})=>o===t);return r.slice(r.indexOf(n),1),this.set("profiles",r),this.save()}}const Tr=d.observable(new Ir);Object.defineProperty(d.prototype,"$config",{get(){return Tr}});Object.defineProperty(d.prototype,"$server",{get(){return{init(){return Promise.resolve()},disabled:!0}}});var kr=384,{createCanvas:D,loadImage:ln,Canvas:fn}=De,Pr=(e,t)=>(t=g({width:null,rotate:!1,flipX:!1,flipY:!1,grayscale:!1},t),t.rotate&&(e=Ar(e)),(t.flipX||t.flipY)&&(e=Rr(e,t.flipX,t.flipY)),e=Or(e,t.width),t.grayscale&&(e=Dr(e)),e),Or=(e,t)=>{t=Math.min(e.width,Math.min(t||e.width,kr));const r=t*(e.height/e.width),n=D(t,r);return n.getContext("2d").drawImage(e,0,0,t,r),n},Rr=(e,t,r)=>{const n=D(e.width,e.height),o=n.getContext("2d");console.log(1-t*2,1-r*2);const i=1-t*2,s=1-r*2;return o.translate(t*e.width,r*e.height),o.scale(i,s),o.drawImage(e,0,0,e.width,e.height),n},Ar=e=>{let t=e.getContext("2d");const r=D(e.height,e.width);return t=r.getContext("2d"),t.fillStyle="white",t.fillRect(0,0,e.height,e.width),t.translate(e.height,0),t.rotate(Math.PI/2),t.drawImage(e,0,0),r},Dr=e=>{const t=e.getContext("2d");return t.putImageData(Fe(t.getImageData(0,0,e.width,e.height)),0,0),e},Fr=(e,t)=>{const r=D();try{return Re(r,e,t),r}catch(n){throw new Error(n)}};async function jr(e,t={}){t=g({margin:0},t);const r=D(t.width||1,t.width||1);return new Promise(n=>{Ae.toCanvas(r,e,t,o=>{if(o)throw o;n(r)})})}var Y=9224,xe=29,Lr=function(e){const t=ne.Buffer.alloc(e.byteLength),r=new Uint8Array(e);for(let n=0;n<t.length;++n)t[n]=r[n];return t},$e=(e,t)=>{const r=e/8%256,n=e/8/256,o=t%256,i=t/256,s=(r+256*n)*(o+256*i);return{xL:r,xH:n,yL:o,yH:i,k:s}},Mr=(e,t)=>{const{k:r}=$e(e,1),n=Y/r;return Math.ceil(t/n)},Vr=e=>{const t=e.getContext("2d"),r=Mr(e.width,e.height),n=[];for(let o=0;o<r;o++)n.push(t.getImageData(0,e.height/r*o,e.width,e.height/r));return n};function Nr(e){const t=(n,o)=>{const i=(o*e.width+n)*4,s=e.data;return{r:s[i],g:s[i+1],b:s[i+2],a:s[i+3]}},r=[];for(let n=0;n<e.height;n++){r[n]=r[n]||[];for(let o=0;o<e.width;o++)r[n][o]=t(o,n)}return r}var Hr=e=>{const t=[],{width:r,height:n}=e,o=Nr(e);for(let i=0;i<n;i++){t[i]=new Uint8Array(Math.round(r/8));for(let s=0;s<t[i].length;s++){t[i][s]=0;for(let a=0;a<8;a++){const{r:c,g:l,b,a:m}=o[i][s*8+a]||{r:255,g:255,b:255,a:255};((c+l+b)/3/255<.6||m<.6)&&(t[i][s]|=1<<7-a)}}}return t},Ur=(e,t)=>{const{xL:r,xH:n,yL:o,yH:i,k:s}=$e(e,t),a=[xe,118,48,0,r,n,o,i];if(a[0]===xe&&a[1]===118&&a[2]===48&&!(s<=Y))throw new Error(`Image too large; ${s} > ${Y}`);return a},zr=async e=>(await Vr(e)).map(n=>{const o=Hr(n);return[ne.Buffer.from(Ur(o[0].length*8,n.height))].concat(o.map(i=>Lr(i)))}).flat();const pn=e=>{const t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0),console.log("update Canvas",t),t.toDataURL("image/png",100)},Br=(e,t,r)=>{if(t){if(e.width<=t)return e;r=t*(e.height/e.width)}else{if(e.height<=r)return e;t=r*(e.width/e.height)}const n=new OffscreenCanvas(t,r);return n.getContext("2d").drawImage(e,0,0,t,r),n},Zr=async e=>{const t=new window.Image;await new Promise(o=>{t.onload=()=>o(t),t.src=e,t.crossOrigin="anonymous"});const r=new OffscreenCanvas(t.naturalWidth,t.naturalHeight);return r.getContext("2d").drawImage(t,0,0),r},hn=(e,t)=>{e=Br(e,$t);const r=e.getContext("2d"),n=r.getImageData(0,0,r.canvas.width,r.canvas.height);return Gr(n.data,[t.printer.preview.foreground,t.printer.preview.background]),r.putImageData(n,0,0),e},Gr=(e,t)=>{for(let r=0;r<e.length;r+=4)(e[r]+e[r+1]+e[r+2])/3/255<.6?(e[r]=t[0][0],e[r+1]=t[0][1],e[r+2]=t[0][2]):(e[r]=t[1][0],e[r+1]=t[1][1],e[r+2]=t[1][2])},B=(e,t)=>(e=Pr(e,t),zr(e)),Wr=(e,t,r)=>{const{fontSize:n,align:o,lineSpace:i,wordGap:s,margin:a,fontFamily:c,color:l,weight:b,italic:m}=g({fontSize:12,align:$.LEFT,wordGap:0,lineSpace:0,margin:0,fontFamily:"sans-serif",color:"#000",weight:400,italic:!1},t),u=[0,r*a,0,0];let P=0,E=r;switch(o){case $.RIGHT:P+=r,E-=u[1];break;case $.LEFT:P+=E/2,E-=u[1];break;default:P+=u[1],E-=u[1];break}const K=`${m?"italic ":""}${b} ${n}px "${c}"`,C=document.createElement("canvas");C.style.display="none",C.width=r,document.body.append(C);const y=C.getContext("2d");y.canvas.style.letterSpacing=`${s}px`,y.font=K,y.fillStyle=l;const Z=Math.max(i,n)/n,ee=e.split(`
`).map(G=>Ce(y,G,0,0,n,E)).flat();return C.height=ee.length*n*Z+u[0]+u[2],y.textBaseline="top",y.font=K,y.canvas.style.letterSpacing=`${s}px`,y.textAlign={[$.LEFT]:"left",[$.CENTER]:"center",[$.RIGHT]:"right"}[Number(o)],y.translate(0,u[0]),ee.forEach((G,Te)=>{y.fillText(G,P,Te*Z*n-(n-Z*n)/2)}),C.remove(),C};function Ce(e,t,r,n,o,i,s=[]){if(i=i||0,i<=0)return[t];for(let a=1;a<=t.length;a++){const c=t.substr(0,a);if(e.measureText(c).width>i)return s.push(t.substr(0,a-1)),s=s.concat(Ce(e,t.substr(a-1),r,n+o,o,i)),s}return s.push(t),s}var Ie={cutLine:{display:()=>({title:"Cut Line"})},barcode:{display:e=>({title:"Barcode",value:e.text}),beforePrinterCommand:async e=>{const{text:t,options:r,imageOptions:n}=e.value,o=await Fr(t||"empty",r||{});return e.value=await B(o,n),e}},qrCode:{display:e=>({title:"QR Code",value:e.text}),beforePrinterCommand:async e=>{const{text:t,options:r,imageOptions:n}=e.value,o=g({},r);o.width=r.width||n.width;const i=await jr(t||"empty",o);return e.value=await B(i,n),e}},image:{display:()=>({title:"Image"}),beforePrinterCommand:async e=>{const{file:t,imageOptions:r}=e.value;return e.value=await B(await Zr(t),r),e}},text:{display:e=>({title:"Text",value:`${e.text.slice(0,16)}\u2026`}),beforePrinterCommand:async e=>{const{text:t,options:r}=e.value,n=await Wr(t||"empty",r||{},xt);return e.value=await B(n),e}},nativeText:{display:e=>({title:"Native Text",value:`${e.slice(0,16)}\u2026`})},feedPitch:{display:({type:e,value:t})=>({title:"Feed-Pitch",value:`${e} | ${t}`})},reset:{display:e=>({property:!0,title:"Reset"})},setAlign:{display:e=>({property:!0,title:"Align",value:`${Object.entries($).find(t=>t[1]===e)[0]}`})},setFont:{display:e=>({property:!0,title:"Font",value:Object.entries(f).find(t=>Number(e)===t[1])[0]})},setLineSpace:{display:e=>({property:!0,title:"Line-Space",value:e})},setWordGap:{display:e=>({property:!0,title:"Word-Gap",value:e})},setMargin:{display:e=>({property:!0,title:"Margin",value:e})},setDensity:{display:e=>({property:!0,title:"Density",value:e})}};class Xr extends je{constructor(){super();this.socket=null,this.connected=!1}async connect(t=3e3,r="localhost",n=!1){const o=n?"wss":"ws";this.io=await this.ready();const i=this.io(`${o}://${r}:${t}`,{autoConnect:!1,reconnection:!1,secure:n,transports:["websocket"]});this.socket=await new Promise((s,a)=>{i.on("error",c=>{this.emit("error",c)}),i.on("connect_error",c=>{this.emit("error",c),a(c)}),i.on("connect",()=>{this.connected=i.connected,this.emit("connect"),s(i)}),i.on("disconnect",()=>{this.disconnect(),this.emit("disconnect")}),i.connect()})}async ready(){if(this.io)return this.io;const{io:t}=await S(()=>import("./index.c6f0c553.js"),[]);return this.io=t,t}get host(){var t,r,n;return(n=(r=(t=this.socket)==null?void 0:t.io)==null?void 0:r.opts)==null?void 0:n.hostname}get port(){var t,r,n,o,i,s;return((n=(r=(t=this.socket)==null?void 0:t.io)==null?void 0:r.opts)==null?void 0:n.port)&&Number((s=(i=(o=this.socket)==null?void 0:o.io)==null?void 0:i.opts)==null?void 0:s.port)||void 0}get secure(){var t,r,n;return(n=(r=(t=this.socket)==null?void 0:t.io)==null?void 0:r.opts)==null?void 0:n.secure}promiseEmit(t,r){return new Promise(n=>{this.socket.emit(t,r,n)})}disconnect(){var t;(t=this.socket)==null||t.destroy(),this.socket=null,this.connected=!1}async getInfo(){const t=await this.promiseEmit("getInfo");return console.log("getInfo",t),t}async executeActions(t){t=await Promise.all(t.map(async n=>"beforePrinterCommand"in Ie[n.type]?await Ie[n.type].beforePrinterCommand(Object.assign({},n)):n));const r=await this.promiseEmit("executeActions",t);console.log("executeActions",r)}}const Q=d.observable(new Xr);lt(Q);Q.on("error",e=>{Ee.add(e)});Object.defineProperty(d.prototype,"$client",{get(){return Q}});class qr{constructor(){this.prompts=[]}prompt(t,r){return new Promise(n=>{const o={title:r,message:t},i=s=>{this.prompts.slice(this.prompts.indexOf(o),1),n(s)};o.callback=i,this.prompts.push(o)})}}const Jr=d.observable(new qr);Object.defineProperty(d.prototype,"$dialog",{get(){return Jr}});d.component("App",Se);new d({render:e=>e(Se)}).$mount("#app");export{$ as A,Jt as B,Et as D,f as F,an as M,x as S,S as _,hn as a,sn as b,nn as c,Lt as d,Ie as e,N as f,Zr as g,w as h,Cr as i,$r as j,tn as k,un as l,z as m,T as n,cn as o,Pr as p,Wr as q,Br as r,ut as s,pn as t,rn as u,Fr as v,jr as w,D as x,on as y};
